---
title: "프로세스 동기화"
categories: OS
---
## Synchronization(동기화)
- 프로세스, 스레드들 사이의 수행 시기를 맞추는 것
- 동시다발적으로 실행되는 프로세스들은 서로 협력하며 영향을 주고 받음
    - 메모장을 입력하면 화면에 출력하는 프로세스, 맞춤법 검사를 하는 프로세스 등이 서로 협력하면서 실행됨
    - 이렇게 협력하여 실행되는 프로세스들은 실행 순서와 자원의 일관성을 보장해야 하기에 반드시 **동기화**가 필요함

### 실행 순서 제어를 위한 동기화
- 특정 조건이 만족되어야만 실행할 수 있는 상황에서 올바른 순서대로 실행하게 하는 것
    - 값을 저장하는 프로세스 A와 저장한 값을 읽는 프로세스 B가 있다고 가정
    - 두 프로세스는 순서가 바뀌어서는 안되고 A -> B 순으로 실행이 되야함
    - 저장하는 프로세스 A가 실행되고 끝나기전에 프로세스 B가 실행된다면 부분적으로만 저장이 되는 문제가 발생함 

### Mutual Exclusion(상호 배제)를 위한 동기화
- Mutual Exclusion(상호 배제)
    - 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하는 알고리즘
    - **생산자와 소비자 문제**
- Shared Resource(공유 자원)
    - 동시에 접근해서는 안되는 자원
    - 전역 변수가 될 수도 있고, 입출력장치나 보조기억장치, 파일이 될 수도 있음
- Critical Section(임계 구역)
    - 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
    - 두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 함
    - Race Condition(레이스 컨디션): 임계 구역에서 잘못된 실행으로 여러 프로세스가 동시 다발적으로 실행되는 현상

### 상호 배제를 위한 동기화 원칙
- Mutual Exclusion(상호 배제): 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없음
- Progress(진행): 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 함
- Bounded Waiting(유한 대기): 한 프로세스가 임계 구역에 들어오기 위해 무한정 대기해서는 안됨

## 동기화 기법
### Mutex Lock
- 임계 구역을 잠금으로써 프로세스 간의 상호 배제위한 동기화 도구
- lock: 프로세스들이 공유하는 전역 변수, 자물쇠 역할을 함
- acquire
    - 프로세스가 임계 구역에 진입하기 전에 호출하는 함수
    - 임계 구역이 잠겨 있다면(lock = true) 잠김이 풀릴 때(lock = false) 까지 임계 구역을 반복적으로 확인함
    - Busy Wait(바쁜 대기): 반복적으로 확인해 보는 방식, 공유 자원이 없을 경우 프로세스는 무작정 무한히 반복하며 확인해야 함
    - 임계 구역이 열려 있다면(lock = false) 잠그는(lock = true) 함수
- release
    - 임계 구역에서의 작업이 끝나고 호출하는 함수
    - 현재 잠긴 임계 구역을 열어주는(lock = false) 함수

### Semaphore(세마포)
- 하나의 공유 자원에 접근하는 Mutex Lock과 달리, 공유 자원이 **여러 개** 있는 임계 구역 문제도 해결할 수 있는 동기화 도구
- 전역 변수 S: 임계 구역에 진입할 수 있는 프로세스의 개수를 나타냄
- wait: 임계 구역에 들어가도 되는지 알려주는 함수
- signal: 임계 구역에 들어가려고 대기 하는 프로세스에게 들어가도 된다는 신호를 주는 함수
- Mutex Lock와 달리 공유 자원이 없을 경우 프로세스는 무작정 무한히 반복하며 확인하지 않고 다른 방법을 사용
    - 사용할 수 있는 자원이 없을 경우 해당 프로세스를 **대기 상태**로 만듦
    - 대기 상태인 프로세스의 PCB를 세마포를 위한 대기 큐에 넣음
    - 다른 프로세스가 임계 구역에서 작업이 끝나고 signal 함수를 호출하면 대기 중인 프로세스를 대기 큐에서 제거
    - 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮김

### Moniter
- 최근에 등장한 동기화 도구, **조건 변수**를 사용하여 Semaphore에 비해 사용자가 사용하기 훨씬 편함
- 공유 자원과 공유 자원에 접근하기 위한 **인터페이스를 묶어** 관리하고 프로세스는 **반드시 인터페이스를 통해서만** 공유 자원에 접근할 수 있음
- 특정 조건을 바탕으로 프로세스를 실행하거나 일시 중단하기 위해 모니터는 **조건 변수** 사용
- Condition Variable(조건 변수): 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수
    - wait: 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 Queue에 삽입하는 연산
    - 특정 프로세스가 아직 실행될 조건이 되지 않았을 때는 wait를 통해 실행을 중단
    - signal: wait를 호출하여 Queue에 삽입된 프로세스의 실행을 재개하는 연산
    - 특정 프로세스가 실행될 조건이 충족되었을 때에는 signal을 통해 실행 재개

**Moniter 사용 예시**
1. 모니터에 진입한 프로세스가 x.wait()를 통해 조건 변수 x에 대한 wait 호출
![Image Lode Failure]({{site.url}}/images/OS/Moniter1.png)
2. 조건 변수 x 대한 Queue에 삽입되므로 Moniter는 비게 됨(다른 프로세스가 Moniter 안으로 들어올 수 있음)
![Image Lode Failure]({{site.url}}/images/OS/Moniter2.png)
3. wait 연산으로 중지된 프로세스는 다른 프로세스의 signal 연산을 통해 실행이 재개됨
![Image Lode Failure]({{site.url}}/images/OS/Moniter3.png)
4. Moniter 안에는 하나의 프로세스만 있을 수 있기 때문에 wait를 호출했던 프로세스는 signal을 호출한 프로세스가 모니터를 떠난뒤에 실행되거나, signal을 호출한 프로세스의 실행을 일시 중단하고 자신이 실행된 뒤 다시 signal을 호출한 프로세스의 수행을 재개함

## Reference
[혼자 공부하는 컴퓨터구조]()
